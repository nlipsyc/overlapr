<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>React Tutorial</title>
    <!-- Not present in the tutorial. Just for basic styling. -->
    <link rel="stylesheet" href="css/base.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
    <script src="hello.js"></script>
  </head>
  <body>

<script type="text/javascript">
function login(network){
  console.log("network", network);
  hello( network ).login().then( function(r){
    // Get Profile
    hello('tumblr').api('blog/'+'nmlapp.tumblr.com'+'/followers/').then(function(r){
      console.log("r", r);
    }  
    // hello(network).api('me').then(function(p){
    //   console.log(p);
    //   document.getElementById('login').innerHTML = "Connected to "+ network+" as " + p.name;
    // }
    );
  }, function(e){
    console.error(e);
  });
}

// hello.init({
//   'tumblr' : 'AFECOJxLzjSrk3lpguwqotAOgtSvBPHyWbdzRhb3ExdNiXE08u'
// },
// {
//   redirect_uri:'../redirect.html',
//   //oauth_proxy: OAUTH_PROXY_URL
// });


//////////////////////
  hello.init({

tumblr: {

      // Ensure that you define an oauth_proxy
      oauth: {
        version: '1.0a',
        auth: 'https://www.tumblr.com/oauth/authorize',
        request: 'https://www.tumblr.com/oauth/request_token',
        token: 'https://www.tumblr.com/oauth/access_token'
      },

      // Set default window height
      login: function(p) {
        p.options.popup.width = 600;
        p.options.popup.height = 510;
      },

      base: 'https://api.tumblr.com/v2/',

      get: {
        me: 'user/info',
        'me/like': 'user/likes',
        'default': function(p, callback) {
          if (p.path.match(/(^|\/)blog\//)) {
            delete p.query.access_token;
            p.query.api_key = hello.services.tumblr.id;
          }

          callback(p.path);
        }
      },

      post: {
        'me/like': function(p, callback) {
          p.path = 'user/like';
          query(p, callback);
        }
      },

      del: {
        'me/like': function(p, callback) {
          p.method = 'post';
          p.path = 'user/unlike';
          query(p, callback);
        }
      },

      wrap: {
        me: function(o) {
          if (o && o.response && o.response.user) {
            o = o.response.user;
          }

          return o;
        },

        'me/like': function(o) {
          if (o && o.response && o.response.liked_posts) {
            o.data = o.response.liked_posts;
            delete o.response;
          }

          return o;
        },

        'default': function(o) {

          if (o.response) {
            var r = o.response;
            if (r.posts) {
              o.data = r.posts;
            }
          }

          return o;
        }
      },

      xhr: function(p, qs) {
        if (p.method !== 'get') {
          return true;
        }

        return false;
      }
    }
  });

  // Converts post parameters to query
  function query(p, callback) {
    if (p.data) {
      extend(p.query, p.data);
      p.data = null;
    }

    callback(p.path);
  }

  function extend(a, b) {
    for (var x in b) {
      if (b.hasOwnProperty(x)) {
        a[x] = b[x];
      }
    }
  }

hello.init({
  'tumblr' : 'AFECOJxLzjSrk3lpguwqotAOgtSvBPHyWbdzRhb3ExdNiXE08u'
},
{
  redirect_uri:'redirect.html'
  // oauth_proxy: 'https://auth-server.herokuapp.com/'
});

function doTheThing(blog){
  hello('tumblr').api('blog/'+blog+'/followers/').then(function(r){
    console.log("r", r);
      
    var a = r.data.map(function(item){
      return "<h2>"+item.title+"</h2>"+item.body_abstract;
    });
    document.getElementById('blogs').innerHTML = a.join('');
  });
}

function getPosts(blog){
  hello('tumblr').api('blog/'+blog+'/posts/text?notes_info=true').then(function(r){
    var a = r.data.map(function(item){
      return "<h2>"+item.title+"</h2>"+item.body_abstract;
    });
    document.getElementById('blogs').innerHTML = a.jon('');
  });
}
</script>


    <div id="content">
        <button id="login" onclick="login('tumblr');">Tumblr</button>

        <button id="blogs" onclick="getPosts('nmlapp.tumblr.com');">Blogs</button>

        <button id="doTheThing" onclick="doTheThing('nmlapp.tumblr.com');">Do The Thing</button>

        <div id="blogs"></div>

        <div id="result"></div>
          <!--<script type="text/babel" src="scripts/overlapr.js"></script>/-->
    </div>
  </body>
</html>
